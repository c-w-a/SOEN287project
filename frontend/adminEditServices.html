<!DOCTYPE html>
<html lang = "en">
<head>
    <title> My Admin Profile </title>
    <meta charset = "utf-8"/>
    <link rel="stylesheet" href="styles.css">
</head>

<body class = "profilestyle">
<a href = "adminPortal.html">
    Go Back
</a>
<h1> Services Offered </h1>
<div class = "container">
<img src = "https://cdn1.iconfinder.com/data/icons/heroicons-solid/20/user-circle-1024.png"
        alt = "admin" width = "50" height = "50" />

        <h2><span id = "adminUser"></span></h2>
    <h3> List of Offered Services</h3>
    <div id = "service-dontainer"></div>

     <h3>Manage</h3>
    <button onclick="addService()">Add services</button>
    <br>
        </div>

    </body>
<script>
    //inspired by code by Lyne
   async function loadServices(){
    try{
        const response = await fetch('/getservices');
        if(response.ok) {
            const services = await response.json();
            displayServices(services);
        } else {
            alert('Could not load services');
        }
    } catch (error) {
        console.error('Error loading services:', error);
    }
}

function displayServices(services){
    const serviceContainer = document.getElementById('service-container');
    serviceContainer.innerHTML = '';

    services.forEach(item => {

        const serviceElement = createServiceElement(item);
        serviceContainer.appendChild(serviceElement);
    });

}

function createServiceElement(service) {
        const serviceItem = document.createElement('div');
        serviceItem.classList.add('service-item');

        serviceItem.innerHTML = `
            <strong>${service.name}</strong><br>
            Description: ${service.description}<br>
            Duration: ${service.duration} Minutes<br>
            Price: ${service.price}$
            <br><br>
        `
        const modifyButton = document.createElement("button");
        modifyButton.textContent = "Modify Service";
        modifyButton.onclick = () => modifyService(service.id);
        serviceItem.appendChild(modifyButton);

        const deleteButton = document.createElement("button");
        deleteButton.textContent = "Delete Service";
        deleteButton.onclick = () => deleteService(service.id);
        serviceItem.appendChild(deleteButton);

        return serviceItem;
    }  

    function addService() {

        window.location.href = 'adminAddServices.html'
    }

    async function modifyService(serviceID) {
         localStorage.setItem('serviceID', serviceID);
         window.location.href = 'adminModifyServices.html'
     }

    async function deleteService(serviceID) {
        if (confirm("Are you sure you want to cancel your service?")) {
            try{
        const response = await fetch(`/delete-service/${serviceID}`, { method: "DELETE" });

        if (response.ok) {
            alert("Service deleted successfully.");
            location.reload(); 
        } else {
            alert("Failed to delete the service. Please try again.");
        }
    }catch (error){
        alert("Error while deleting service")
    }
}
}
    
    window.onload = loadServices;
 
</script>
</html>
